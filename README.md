# MindDomain (心灵空间)

一个 Minecraft Fabric Mod，为每位玩家提供与自身绑定的私人维度空间。

## 功能概览

- **个人维度空间**：每个玩家拥有完全独立的维度实例，与其他玩家完全隔离
- **空间球系统**：通过不同大小的空间球开辟空间（如 `16×16×16 空间球`）
- **快捷键进出**：`I` 键进入空间，`O` 键离开空间（可在设置中自定义）
- **空间替换**：`V` 键将脚下区域与空间维度进行双向方块/实体交换
- **位置记忆**：记录空间内/外坐标，进出时自动恢复位置
- **死亡掉落**：玩家死亡后空间解绑，掉落发光的空间球（永不消失），任何人可继承
- **空间等级系统**：玩家获取经验时同步计入空间等级，升级后空间自动扩大
- **不可破坏边界**：全白色屏障方块构成的空间边界，任何游戏模式下均不可破坏
- **纯白空间渲染**：天空、雾气、光照全方位纯白效果
- **管理员指令**：通过 `/md visit <玩家>` 访问指定玩家的空间

## 安装

### 前置要求

- Minecraft 1.21.11
- Fabric Loader >= 0.18.4
- Fabric API >= 0.141.3+1.21.11
- Fabric Language Kotlin >= 1.13.9+kotlin.2.3.10

### 安装步骤

1. 安装 [Fabric Loader](https://fabricmc.net/use/)
2. 将以下 Mod 放入 `.minecraft/mods/` 文件夹：
   - Fabric API
   - Fabric Language Kotlin
   - MindDomain（本 Mod）
3. 启动游戏

## 使用指南

### 基本操作

| 操作 | 方式 | 说明 |
|------|------|------|
| 开辟空间 | 右键使用空间球 | 消耗空间球，创建个人维度 |
| 进入空间 | 按 `I` 键 或 `/md enter` | 传送至空间内上次位置 |
| 离开空间 | 按 `O` 键 或 `/md leave` | 传送回进入前的位置 |
| 空间替换 | 按 `V` 键 | 将脚下区域与空间维度双向交换 |

### 空间替换

在现实世界中按下 `V` 键，可将玩家脚下区域的方块和实体与空间维度内的对应区域进行**双向交换**：

- 空间内的建筑会出现在现实世界脚下
- 现实世界脚下的方块和实体会被移入空间
- 方块实体（箱子内容、熔炉状态等）完整保留
- 非玩家实体（动物、怪物等）跟随方块一起交换

### 空间球

- 空间球品质以大小表示：`4×4×4`、`16×16×16`、`32×32×32` 等
- 外观为半透明白蓝色水晶球体
- 一个玩家同时只能绑定一个空间
- 已有空间时无法使用新的空间球

### 死亡掉落机制

- 玩家死亡时，空间会解绑并掉落一个命名空间球
- 掉落的空间球具有特殊属性：
  - **永不消失**：不同于普通物品 5 分钟消失的机制，空间球永久存在于地面
  - **发光效果**：空间球带有高亮轮廓，便于在复杂地形中找到
  - **携带数据**：记录原拥有者名称、空间大小和空间 ID
- 空间球名称为 `<玩家名>的空间`，tooltip 显示具体大小和原拥有者
- 任何人拾取后使用即可继承该空间（包括其中的建设内容）

### 指令

| 指令 | 权限 | 说明 |
|------|------|------|
| `/md enter` | 所有玩家 | 进入自己的空间 |
| `/md leave` | 所有玩家 | 离开空间 |
| `/md info` | 所有玩家 | 查看自己的空间信息 |
| `/md visit <玩家>` | OP 2级 | 传送到指定玩家的空间 |
| `/md info <玩家>` | OP 2级 | 查看指定玩家的空间信息 |

## 空间特性

- **全白虚空**：初始空间无方块，天空和背景均为纯白色
- **白色不可破坏边界**：
  - 地面、天花板、四周墙壁均使用自定义的白色屏障方块
  - 白色外观与天空无缝融合，营造纯白空间感
  - 任何游戏模式下均不可破坏（包括创造模式）
  - 不可被活塞推动、不允许生物生成
- **纯白渲染**：
  - 光照、雾气、方向亮度全方位白色处理
- **WorldBorder 安全边界**：
  - 设在白色屏障墙壁之外，作为最终安全防线
  - 距离足够远，玩家不会看到 WorldBorder 动画效果
- **自由建设**：玩家可在空间范围内自由放置和破坏方块

## 空间等级系统

空间等级独立于 Minecraft 原版等级系统，只增不减。

### 经验获取

- 玩家通过正常游戏获取经验（杀怪、挖矿、熔炼等）时，这些经验**同时**计入空间等级
- 附魔消耗原版等级不会影响空间等级和经验
- 空间等级系统完全隔离，永不减少

### 升级公式

从等级 N 升至 N+1 所需经验：**100 × N**

| 等级变化 | 所需经验 |
|----------|----------|
| 1 → 2 | 100 XP |
| 2 → 3 | 200 XP |
| 3 → 4 | 300 XP |
| N → N+1 | 100×N XP |

### 空间扩展

- 每升一级，空间边长 +2（三个维度同步增长）
- 垂直高度达到上限（1024 格）后，每级改为水平 +4 作为补偿
- 升级时自动更新空间边界，玩家会收到通知消息
- 空间内已有的建设不受影响

## 技术信息

- **MC 版本**：1.21.11
- **模组加载器**：Fabric
- **开发语言**：Kotlin
- **许可证**：MIT
- **开发文档**：[docs/development/](docs/development/)

### 自定义方块

| 方块 | 用途 | 特性 |
|------|------|------|
| 白色屏障 (`white_barrier`) | 空间边界 | 纯白纹理、硬度 -1、不可爆炸、不可被活塞推动 |

### Mixin 列表

| Mixin | 目标类 | 用途 |
|-------|--------|------|
| `MinecraftServerAccessor` | `MinecraftServer` | 访问 `worlds` 和 `session` 字段用于动态维度注册 |
| `ServerWorldAccessor` | `ServerWorld` | 访问 `entityManager` 用于空间替换时异步实体加载 |
| `ItemEntityAccessor` | `ItemEntity` | 访问 `itemAge` 字段用于空间球永不消失机制 |
| `PlayerEntityMixin` | `PlayerEntity` | 注入 `addExperience` 方法，同步经验到空间等级系统 |
| `ClientWorldMixin` | `ClientWorld` | 在心灵空间内移除方向光照衰减，所有面均匀亮度 |
| `FogRendererMixin` | `BackgroundRenderer` | 在心灵空间内强制雾气颜色为纯白 |
| `LightmapTextureManagerMixin` | `LightmapTextureManager` | 在心灵空间内将光照贴图填充为全白 |

## 已知问题

- 空间球目前无合成配方，需通过指令或数据包获取初始空间球

## 更新日志

### v1.2.0-SNAPSHOT
- 实现空间替换系统（V 键双向交换现实/空间方块和实体）
- 实现客户端纯白渲染链（方向光照、雾气、光照贴图三层 Mixin）
- 修复空间高度上限问题（垂直上限 1024 格，超出后水平补偿扩展）
- 维度高度扩展至 1168（支持大型空间）
- 新增 V 键快捷键绑定

### v1.1.0-SNAPSHOT
- 实现空间等级系统（独立于原版等级，经验同步计入，升级扩大空间）

### v1.0-SNAPSHOT
- 初始版本
- 实现空间球物品和使用机制
- 实现动态独立维度创建
- 实现快捷键进出空间（I/O 键）
- 实现管理员指令系统（/md）
- 实现死亡掉落和空间继承机制
- 实现纯白天空渲染和 WorldBorder 边界
- 实现位置记忆（空间内/外坐标）
- 添加白色屏障方块（不可破坏的白色边界）
- 添加创造模式方块破坏保护
- 空间球贴图更新为半透明水晶球体设计
- 死亡掉落空间球增加永不消失和发光效果
